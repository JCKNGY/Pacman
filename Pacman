using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Audio;
using Microsoft.Xna.Framework.Content;
using Microsoft.Xna.Framework.GamerServices;
using Microsoft.Xna.Framework.Graphics;
using Microsoft.Xna.Framework.Input;
using Microsoft.Xna.Framework.Media;
using System;
using System.Collections.Generic;
using System.Linq;

namespace Pacman
{
    /// <summary>
    /// This is the main type for your game
    /// </summary>
    public class Game1 : Microsoft.Xna.Framework.Game
    {
        GraphicsDeviceManager graphics;
        SpriteBatch spriteBatch;

        Texture2D pacTxt;
        Texture2D hallwayCheck;
        Rectangle pacman;
        Rectangle pacmanDestination;

        Rectangle hallway1;
        Rectangle hallway2;
        Rectangle hallway3;
        Rectangle hallway4;
        Rectangle hallway5;
        Rectangle hallway6;
        Rectangle hallway7;
        Rectangle hallway8;
        Rectangle hallway9;
        Rectangle hallway10;
        Rectangle hallway11;
        Rectangle hallway12;
        Rectangle hallway13;
        Rectangle hallway14;
        Rectangle hallway15;
        Rectangle hallway16;
        Rectangle hallway17;
        Rectangle hallway18;

        int pacSpeed;
        int pacDirection;
        int text = 30;
        Vector2 pacMovement;
        Vector2 pacPos;
        Vector2 pacStart;

        //Background stage
        Rectangle background;
        Texture2D background_tex;

        KeyboardState oldKB;

        public Game1()
        {
            graphics = new GraphicsDeviceManager(this);
            Content.RootDirectory = "Content";

            graphics.PreferredBackBufferWidth = 772;
            graphics.PreferredBackBufferHeight = 864;
            graphics.ApplyChanges();

            this.Window.AllowUserResizing = true;


        }

        /// <summary>
        /// Allows the game to perform any initialization it needs to before starting to run.
        /// This is where it can query for any required services and load any non-graphic
        /// related content.  Calling base.Initialize will enumerate through any components
        /// and initialize them as well.
        /// </summary>
        protected override void Initialize()
        {
            // TODO: Add your initialization logic here
            pacMovement = new Vector2();
            pacPos = new Vector2();
            pacSpeed = 3; //Pacman's base movement speed
            pacMovement.X = pacSpeed;
            pacMovement.Y = 0; //Pacman begins game moving right
            pacPos.X = 0;
            pacPos.Y = 0;
            pacStart.X = 100;
            pacStart.Y = 100; //pacman starting position

            pacman = new Rectangle(639, 67, 60, 60);
            pacmanDestination = new Rectangle((int)pacStart.X, (int)pacStart.Y, text, text);
            pacDirection = 0;

            //vertical
            hallway1 = new Rectangle(152, 0, 52, 864);
            hallway2 = new Rectangle(567, 0, 52, 864);
            hallway3 = new Rectangle(17, 0, 52, 864);
            hallway4 = new Rectangle(240, 0, 52, 864);
            hallway5 = new Rectangle(320, 0, 52, 864);
            hallway6 = new Rectangle(400, 0, 52, 864);
            hallway7 = new Rectangle(702, 0, 52, 864);
            hallway8 = new Rectangle(487, 0, 52, 864);
            //horizontal
            hallway9 = new Rectangle(0, 0, 864, 52);
            hallway10 = new Rectangle(0, 120, 864, 52);
            hallway11 = new Rectangle(0, 200, 864, 52);
            hallway12 = new Rectangle(0, 380, 864, 52);
            hallway13 = new Rectangle(0, 535, 864, 52);
            hallway14 = new Rectangle(0, 625, 864, 52);
            hallway15 = new Rectangle(0, 705, 864, 52);
            hallway16 = new Rectangle(0, 790, 864, 52);
            hallway17 = new Rectangle(0, 280, 864, 52);
            hallway18 = new Rectangle(0, 450, 864, 52);

            //Background stage
            background = new Rectangle(0, 0, GraphicsDevice.Viewport.Width, GraphicsDevice.Viewport.Height);



            base.Initialize();
        }

        /// <summary>
        /// LoadContent will be called once per game and is the place to load
        /// all of your content.
        /// </summary>
        protected override void LoadContent()
        {
            // Create a new SpriteBatch, which can be used to draw textures.
            spriteBatch = new SpriteBatch(GraphicsDevice);

            // TODO: use this.Content to load your game content here
            pacTxt = this.Content.Load<Texture2D>("Pac-Man SpriteSheet");
            hallwayCheck = this.Content.Load<Texture2D>("wall");


            //background stage
            background_tex = this.Content.Load<Texture2D>("pacman map");

        }

        /// <summary>
        /// UnloadContent will be called once per game and is the place to unload
        /// all content.
        /// </summary>
        protected override void UnloadContent()
        {
            // TODO: Unload any non ContentManager content here
        }

        /// <summary>
        /// Allows the game to run logic such as updating the world,
        /// checking for collisions, gathering input, and playing audio.
        /// </summary>
        /// <param name="gameTime">Provides a snapshot of timing values.</param>
        protected override void Update(GameTime gameTime)
        {
            KeyboardState kb = Keyboard.GetState();
            // Allows the game to exit
            if (GamePad.GetState(PlayerIndex.One).Buttons.Back == ButtonState.Pressed)
                this.Exit();

            // TODO: Add your update logic here

            if ((kb.IsKeyDown(Keys.W) || kb.IsKeyDown(Keys.Up)) && wallCollideVertical())
            {
                pacMovement.X = 0;
                pacMovement.Y = (-1 * pacSpeed);
                pacDirection = 270;
            }
            if ((kb.IsKeyDown(Keys.D) || kb.IsKeyDown(Keys.Right)) && wallCollideHorizontal())
            {
                pacMovement.X = pacSpeed;
                pacMovement.Y = 0;
                pacDirection = 0;
            }
            if ((kb.IsKeyDown(Keys.S) || kb.IsKeyDown(Keys.Down)) && wallCollideVertical())
            {
                pacMovement.X = 0;
                pacMovement.Y = pacSpeed;
                pacDirection = 90;
            }
            if ((kb.IsKeyDown(Keys.A) || kb.IsKeyDown(Keys.Left)) && wallCollideHorizontal())
            {
                pacMovement.X = (-1 * pacSpeed); ;
                pacMovement.Y = 0;
                pacDirection = 180;
            }

            pacPos.X += pacMovement.X;
            pacPos.Y += pacMovement.Y;
            pacmanDestination = new Rectangle((int)(pacStart.X + pacPos.X), (int)(pacStart.Y + pacPos.Y), text, text);

            wallCollideVertical(); //runs method
            wallCollideHorizontal();

            oldKB = kb;
            base.Update(gameTime);
        }

        public bool wallCollideVertical()
        {
            //method makes sure Pacman snaps properly in grid
            if(isOverlapping(pacmanDestination, hallway1))
            {
                if (pacMovement.Y != 0)
                    pacmanDestination.X = 177;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway2))
            {
                if (pacMovement.Y != 0)
                    pacmanDestination.X = 593;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway3))
            {
                if (pacMovement.Y != 0)
                    pacmanDestination.X = 43;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway4))
            {
                if (pacMovement.Y != 0)
                    pacmanDestination.X = 266;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway5))
            {
                if (pacMovement.Y != 0)
                    pacmanDestination.X = 346;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway6))
            {
                if (pacMovement.Y != 0)
                    pacmanDestination.X = 426;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway7))
            {
                if (pacMovement.Y != 0)
                    pacmanDestination.X = 728;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway8))
            {
                if (pacMovement.Y != 0)
                    pacmanDestination.X = 513;
                return true;
            }
            return false;
        }
        public bool wallCollideHorizontal()
        {
            //method makes sure Pacman snaps properly in grid
            if (isOverlapping(pacmanDestination, hallway9))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 26;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway10))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 146;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway11))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 226;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway12))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 406;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway13))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 561;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway14))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 651;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway15))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 731;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway16))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 816;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway17))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 306;
                return true;
            }
            if (isOverlapping(pacmanDestination, hallway18))
            {
                if (pacMovement.X != 0)
                    pacmanDestination.Y = 476;
                return true;
            }
            return false;
        }
        bool isOverlapping(Rectangle rec1, Rectangle rec2)
        {
            return (rec1.Right > rec2.Left && rec1.Left < rec2.Right && rec1.Bottom > rec2.Top && rec1.Top < rec2.Bottom);
        }

        /// <summary>
        /// This is called when the game should draw itself.
        /// </summary>
        /// <param name="gameTime">Provides a snapshot of timing values.</param>
        protected override void Draw(GameTime gameTime)
        {
            GraphicsDevice.Clear(Color.Black);

            // TODO: Add your drawing code here
            spriteBatch.Begin();
            //Background stage
            spriteBatch.Draw(background_tex, background, Color.White);

            //Pacman
            //spriteBatch.Draw(hallwayCheck, hallway1, Color.White);
            //spriteBatch.Draw(hallwayCheck, hallway2, Color.White);
            //spriteBatch.Draw(hallwayCheck, hallway3, Color.White);
            //spriteBatch.Draw(hallwayCheck, hallway4, Color.White);
            //spriteBatch.Draw(hallwayCheck, hallway5, Color.White);
            //spriteBatch.Draw(hallwayCheck, hallway6, Color.White);
            //spriteBatch.Draw(hallwayCheck, hallway7, Color.White);
            //spriteBatch.Draw(hallwayCheck, hallway8, Color.White);
            //spriteBatch.Draw(hallwayCheck, hallway9, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway10, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway11, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway12, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway13, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway14, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway15, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway16, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway17, Color.Red);
            //spriteBatch.Draw(hallwayCheck, hallway18, Color.Red);

            spriteBatch.Draw(pacTxt, pacmanDestination, pacman, Color.White, (float)MathHelper.ToRadians(pacDirection), new Vector2(60 / 2, 60 / 2), SpriteEffects.None, 0);

            spriteBatch.End();
            base.Draw(gameTime);
        }
    }
}
